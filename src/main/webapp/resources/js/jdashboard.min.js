/*!
 * jDashboard v2.1
 * http://codecanyon.net/item/jdashboard/135111
 *
 * Copyright (c) 2010-2012 Sarathi Hansen
 * http://www.codecanyon.net/user/sarthemaker
 *
 * Includes: Cookie plugin
 * http://plugins.jquery.com/project/Cookie
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses
 *
 * Date: December 1st, 2012
 */
(function(f){function t(){this.isCollapsed=!this.isCollapsed;var b=this;this.body.slideToggle(100,function(){"none"===b.body.css("display")&&b.$.addClass("jdash_collapsed")});"block"===this.body.css("display")&&this.$.removeClass("jdash_collapsed");i(this.dashboard)}function u(){(this.isRemoved=!this.isRemoved)?(this.$.addClass("jdash_hidden"),this.style.display="none",this.dashboard.appendChild(this)):(this.$.removeClass("jdash_hidden"),this.style.display="block",this.dashboard.columns[this.dashboard.columns.length-
1].appendChild(this));this.style.display=this.isRemoved?"none":"block";i(this.dashboard)}function i(b){b.options.storageScript?f.ajax({type:"post",url:b.options.storageScript,data:{jdashStorage:k(b),jdashStorageID:b.options.storageID,type:"save"}}):l?localStorage["jdashStorage?dashID:"+b.id+"&storageID:"+b.options.storageID]=k(b):n&&f.cookie("jdashStorage?dashID:"+b.id+"&storageID:"+b.options.storageID,k(b))}function k(b){for(var a="",b=b.$.find(".jdash-widget"),c=b.length;c--;)a+=b[c].id+","+b.eq(c).parent().index()+
","+(b[c].isCollapsed?"1":"0")+","+(b[c].isRemoved?"1":"0"),0<c&&(a+="/");return a}function m(b,a){for(var c,e,d=a.split("/"),g=d.length;g--;)if(c=d[g].split(","),e=document.getElementById(c[0]))"1"===c[3]?(e.$.addClass("jdash_hidden"),e.style.display="none",e.isRemoved=!0,b.appendChild(e)):(e.$.removeClass("jdash_hidden"),e.style.display="block",e.isRemoved=!1,b.columns[parseFloat(c[1])].appendChild(e)),"1"===c[2]?(e.$.addClass("jdash_collapsed").find(".jdash-body").hide(),e.isCollapsed=!0):(e.$.removeClass("jdash_collapsed").find(".jdash-body").show(),
e.isCollapsed=!1);c=b.$.children(".jdash-widget:not(.jdash_hidden)");e=0;for(g=c.length;g--;)b.columns[e].appendChild(c[g]),c[g].isRemoved||(c[g].style.display="block"),e++,e>=b.columns.length&&(e=0);c=f(b.options.controls);c.addClass("jdash-controls");for(e=b.widgets.length;e--;){g=b.widgets[e];d=document.createElement("label");d.innerHTML="<span>"+f(g.$.find(".jdash-header-inner")[0].firstChild).text().replace(/^\s+|\s+$/,"")+"</span>";c.append(d);var h=document.createElement("input");h.type="checkbox";
h.id="jdash-control_"+b.id+"-"+e;h.widget=g;g.isRemoved||(h.checked="checked");h.onclick=function(){f.proxy(u,this.widget)()};f(d).prepend(h)}b.$.trigger("load")}function p(b){var a=f(b.target);if(!a.hasClass("jdash-collapse")&&!a.parents().is(".jdash-toolbar"))return null==this.dashboard.widgetReady&&null==this.dashboard.widgetDragging&&(a=this.$.offset(),b=q(b),this.dragOffsetLeft=a.left,this.dragOffsetTop=a.top,this.clickOffsetLeft=b.x-a.left,this.clickOffsetTop=b.y-a.top,this.dashboard.widgetReady=
this),!1}function r(){if(null==this.widgetDragging)this.widgetReady=null;else{var b=this.widgetDragging,a=b.$.offset();b.$.insertBefore(this.sector.$);b.style.marginBottom=-b.offsetHeight-parseFloat(b.$.css("marginTop"))+"px";b.style.top=a.top-this.sector.$.offset().top+"px";b.style.left=a.left-this.sector.$.parent().offset().left-parseFloat(b.$.css("marginLeft"))+"px";this.sector.$.animate({height:b.$.height()},200);b.$.animate({left:0,top:0},200,"",function(){this.style.marginBottom=this.$.css("marginTop");
this.dashboard.sector.$.hide();this.$.removeClass("jdash_dragging")});i(this);this.widgetDragging=this.widgetReady=null}}function s(b){var a;null==this.widgetDragging&&null!=this.widgetReady&&(this.widgetDragging=this.widgetReady,this.widgetReady=null,a=this.widgetDragging,a.$.addClass("jdash_dragging"),a.style.marginBottom=-a.$.outerHeight()-parseFloat(a.$.css("marginTop"))+"px",this.sector.$.insertAfter(a),this.sector.style.display="block",this.sector.style.height=a.$.height()+"px");if(null!=this.widgetDragging){a=
b.clientY;"undefined"==typeof a&&(a=(b.originalEvent.touches[0]||b.originalEvent.changedTouches[0]).clientY-f(window).scrollTop());40>a&&window.scrollTo(0,f(window).scrollTop()-10);a>f(window).height()-40&&window.scrollTo(0,f(window).scrollTop()+10);a=this.widgetDragging;var b=q(b),c=b.x-a.dragOffsetLeft-a.clickOffsetLeft,e=b.y-a.dragOffsetTop-a.clickOffsetTop,d,g=!1,h=a.$.offset(),i=h.left+a.offsetWidth/2,j=this.sector.$.parent();a.style.left=c+"px";a.style.top=e+"px";if(j.prev(".jdash-column").length&&
(d=j.prev()[0])&&i+10<d.$.offset().left+d.offsetWidth)d.appendChild(this.sector),h=a.$.offset(),g=!0;else if(j.next(".jdash-column").length&&(d=j.next()[0])&&i-10>d.$.offset().left)d.appendChild(this.sector),h=a.$.offset(),g=!0;if(d=this.sector.previousSibling)d===a&&(d=d.previousSibling),d&&h.top+10<d.$.offset().top+d.offsetHeight/2&&(d.parentNode.insertBefore(this.sector,d),h=a.$.offset(),g=!0);if(d=this.sector.nextSibling)d===a&&(d=d.nextSibling),d&&h.top+a.offsetHeight-10>d.$.offset().top+d.offsetHeight/
2&&(d.parentNode.insertBefore(this.sector,d.nextSibling),h=a.$.offset(),g=!0);g&&(a.dragOffsetLeft=h.left-c,a.dragOffsetTop=h.top-e,a.style.left=b.x-a.dragOffsetLeft-a.clickOffsetLeft+"px",a.style.top=b.y-a.dragOffsetTop-a.clickOffsetTop+"px")}}function q(b){"undefined"==typeof b.pageX&&(b=b.originalEvent.touches[0]||b.originalEvent.changedTouches[0]);return{x:b.pageX,y:b.pageY}}var l=null!==window.localStorage;if(!l){f.cookie=function(b,a,c){if("undefined"!=typeof a){c=c||{};null===a&&(a="",c.a=
-1);var e="";if(c.a&&("number"==typeof c.a||c.a.toUTCString))"number"==typeof c.a?(e=new Date,e.setTime(e.getTime()+864E5*c.a)):e=c.a,e="; expires="+e.toUTCString();document.cookie=[b,"=",encodeURIComponent(a),e,c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.b?"; secure":""].join("")}else{a=null;if(document.cookie&&""!=document.cookie){c=document.cookie.split(";");for(e=0;e<c.length;e++){var d=f.trim(c[e]);if(d.substring(0,b.length+1)==b+"="){a=decodeURIComponent(d.substring(b.length+
1));break}}}return a}};f.cookie("jdashCookiesOn","1");var n="1"===f.cookie("jdashCookiesOn");f.cookie("jdashCookiesOn",null)}f.fn.jDashboard=function(b){b=f.extend({columns:2,storage:"local"},b);return this.each(function(){this.$=f(this).addClass("jdash");this.options=b;this.columnWidth="number"===typeof b.columns?b.columnWidth?b.columnWidth:100/b.columns+"%":!1;var a=[],c,e=this.columnWidth?this.options.columns:this.options.columns.length;for(this.columnWidth||this.options.columns.reverse();e--;)c=
document.createElement("div"),c.$=f(c).addClass("jdash-column").css({width:this.columnWidth?this.columnWidth:this.options.columns[e]+"%"}).appendTo(this),a.push(c);this.$.append('<div class="clear"></div>');this.columns=a;c=this.$.find(".jdash-widget");for(e=c.length;e--;)a=c[e],a.$=c.eq(e),a.originalIndex=e,a.dashboard=this,a.body=a.$.find(".jdash-body"),a.body.children(".jdash-info").append('<div class="jdash-info-arrow_fill"></div><div class="jdash-info-arrow_stroke"></div>'),a.isDragInit=a.isDragging=
a.isCollapsed=a.isRemoved=!1,a.dragOffsetLeft=a.dragOffsetTop=a.clickOffsetLeft=a.clickOffsetTop=0,a.$.hasClass("jdash_collapsed")&&(a.isCollapsed=!0,a.body.hide()),a.$.hasClass("jdash_hidden")&&(a.isRemoved=!0,a.style.display="none",this.appendChild(a)),a.$.find(".jdash-header").html(a.$.find(".jdash-header").html().replace(/^\s+/,"")),a.$.find(".jdash-header").append(f(document.createElement("div")).addClass("jdash-collapse").on("click",f.proxy(t,a))).wrapInner('<div class="jdash-header-inner" />').on({mousedown:f.proxy(p,
a),touchstart:f.proxy(p,a)});this.widgets=c;a=document.createElement("div");a.$=f(a).addClass("jdash-sector");this.appendChild(a);this.sector=a;this.widgetDragging=this.widgetReady=null;f(document).on({mousemove:f.proxy(s,this),touchmove:f.proxy(s,this),mouseup:f.proxy(r,this),touchend:f.proxy(r,this)});var d=this;d.options.storageScript?f.ajax({type:"post",url:d.options.storageScript,data:{jdashStorageID:d.options.storageID,type:"load"},success:function(a){m(d,a)}}):l?(a=localStorage.getItem("jdashStorage?dashID:"+
d.id+"&storageID:"+d.options.storageID),m(d,a?a:"")):n&&(a=f.cookie("jdashStorage?dashID:"+d.id+"&storageID:"+d.options.storageID),m(d,a?a:""))})}})(jQuery);