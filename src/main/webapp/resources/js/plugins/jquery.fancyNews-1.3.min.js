/*!
 * Fancy News v1.3
 *
 * Copyright 2011, Rafael Dery
 *
 * Only for sale at the envato marketplaces
 */

/* The h3 and h4 has been swapped. - ALM */
/* $(previewCons[i]).hide().delay((200+(i*200))).fadeIn(800) - is now - $(previewCons[i]).hide().delay((200+(i*200))).show() - ALM */
/* Also added p tags around the news text. Altered "[....]" - ALM */
/* Added '<a href='"+links[i]+"' target='_blank' class='readMore'>read more</a>' in the preview[i] code - ALM */

/*** If you need to make a change do it in the unminified version first ***/

(function(e){function t(e,t){var n=e.split(" ");var r="";if(n.length>t){for(var i=0;i<t;++i){r+=n[i]+" "}return r}else{return e}}function n(e,t,n){var r=String(e+"-"+t+" of "+n+" posts");return r}jQuery.fn.fancyNews=function(r){function b(t){s=e(t);var n=e.makeArray(s.find("div").hide());s.css({overflow:"hidden",position:"relative",width:i.width,height:i.height+i.previewOffset*i.previewsPerPage});s.append("<div id='fn-preloader'></div>");s.find("#fn-preloader").css({top:i.height*.5-s.find("#fn-preloader").height()*.5,left:i.width*.5-s.find("#fn-preloader").width()*.5});o=i.height/i.previewsPerPage;if(i.feed){E()}else{w(n)}}function w(n){var r=[];for(var s=0;s<n.length;++s){l[s]=e(n[s]).attr("title")?e(n[s]).attr("title"):"";f[s]=e(n[s]).children("span").attr("title").length>0?e(n[s]).find("span").attr("title"):"";c[s]=t(e(n[s]).children("span").text(),i.maxWords)+"...";h[s]=e(n[s]).children("span").html();var u=e(n[s]).children("img").attr("src");var a=u?'<img class="fn-newsPreviewThumb" src="'+u+'" />':"";r[s]="<div class='fn-newsPreview' style='width:"+i.width+"px; height:"+o+"px; background:"+i.backgroundColor+";'>"+a+"<span class='fn-newsPreviewText' ><h4>"+l[s]+"</h4><h3>"+f[s]+"</h3><p>"+c[s]+"</p><a href='#' target='_blank' class='readMore'>read more</a></span></div>"}S(r)}function E(){var n=[];e.jGFeed(i.feed,function(e){if(!e){A("No feeds found! Please check your RSS feed!");return false}for(var r=0;r<e.entries.length;r++){var s=e.entries[r];f[r]=s.title;l[r]=String(s.publishedDate).substr(0,16);c[r]=t(s.contentSnippet.slice(0,s.contentSnippet.length-3),i.maxWords)+"...";h[r]=s.content;p[r]=s.link;n[r]="<div class='fn-newsPreview' style='width:"+i.width+"px; height:"+o+"px; background:"+i.backgroundColor+";'><span class='fn-newsPreviewText' ><h4>"+l[r]+"</h4><h3>"+f[r]+"</h3><p>"+c[r]+"</p></span><div class='clear'></div><a href='"+p[r]+"' target='_blank' class='readMore'>read more</a></div>"}S(n)},i.numOfEntries)}function S(t){s.find("#fn-preloader").remove();for(var r=0;r<t.length;++r){s.append(t[r]).find(".fn-newsPreview:last").css({top:r*(o+i.previewOffset)})}d=e.makeArray(s.find(".fn-newsPreview"));s.append("<div id='fn-newsView' style='width:"+i.width+"px;height:"+s.height()+"px;'><h3 id='fn-newsViewTitle'></h3><div id='fn-newsViewHtml' style='width:"+(i.width-30)+"px;height:"+(s.height()-50)+"px;'></div></div>");s.find("#fn-newsViewHtml").jScrollPane();var a=s.find("#fn-newsViewHtml");a.jScrollPane();u=a.data("jsp");s.after("<div id='fn-newsFooterBar' style='width:"+i.width+"px;background:"+i.backgroundColor+"'><span id='newsFooterText'>"+n(v+1,v+i.previewsPerPage,d.length)+"</span><span id='fn-previousButton'></span><span id='fn-nextButton'></span><div id='fn-newsViewClose'></div></div>");s.next("#fn-newsFooterBar").hide();s.next("#fn-newsFooterBar").find("#fn-newsViewClose").hide().click(function(){k();s.next("#fn-newsFooterBar").find("#newsFooterText").text(n(v+1,v+i.previewsPerPage,d.length));s.find("#fn-newsView").stop().fadeTo(500,0,function(){e(this).css("visibility","hidden")})});for(var r=0;r<i.previewsPerPage;++r){e(d[r]).hide().delay(200+r*200).show()}setTimeout(function(){s.next("#fn-newsFooterBar").fadeIn(800,x)},200+i.previewsPerPage*200)}function x(){m=false;s.find(".fn-newsPreview").hover(function(){if(m)return;m=true;e(this).stop().animate({backgroundColor:i.backgroundOverColor},800)},function(){if(g)return;m=false;e(this).stop().animate({backgroundColor:i.backgroundColor},500)}).click(function(){if(g)return;var t=s.find(".fn-newsPreview").index(this);if(i.useLinks&&i.feed){window.open(p[t],i.targetWindow)}else{var n=h[t];k();s.find("#fn-newsView").css({visibility:"visible",opacity:0}).stop().fadeTo(500,1);s.find("#fn-newsViewTitle").text(f[t]);s.next("#fn-newsFooterBar").find("#newsFooterText").text(l[t]);u.getContentPane().html(n);u.reinitialise({verticalGutter:15});u.scrollToPercentY(0);e("#fn-newsView img").jScale({ls:i.longestImageSide})}});s.next("#fn-newsFooterBar").find("#fn-previousButton").click(function(){if(v!=0&&!m)N()});s.next("#fn-newsFooterBar").find("#fn-nextButton").click(function(){if(v!=d.length-i.previewsPerPage&&!m)T()});if(i.slideTime)a=setInterval(L,i.slideTime)}function T(){C("-");++v;s.next("#fn-newsFooterBar").find("#newsFooterText").text(n(v+1,v+i.previewsPerPage,d.length));e(d[v+i.previewsPerPage-1]).css("opacity",0).animate({opacity:1},300,function(){m=g=false})}function N(){--v;C("+");s.next("#fn-newsFooterBar").find("#newsFooterText").text(n(v+1,v+i.previewsPerPage,d.length));e(d[v]).css("opacity",0).animate({opacity:1},function(){m=g=false})}function C(t){g=m=true;var n=o+2;for(var r=v;r<d.length;++r){e(d[r]).animate({top:t+"="+n+"px"},300)}}function k(){if(s.next().find("#fn-previousButton").is(":hidden")){s.next().find("#fn-newsViewClose").hide();s.next().find("#fn-previousButton, #fn-nextButton").show();if(i.slideTime)a=setInterval(L,i.slideTime)}else{s.next().find("#fn-newsViewClose").show();s.next().find("#fn-previousButton, #fn-nextButton").hide();if(i.slideTime)clearInterval(a)}}function L(){if(m)return;if(v!=0&&!m&&y=="previous"){N()}else y="next";if(v!=d.length-i.previewsPerPage&&!m&&y=="next"){T()}else y="previous"}function A(e){s.find("#fn-preloader").remove();s.append("<span id='fc-error'>"+e+"</span>")}var i=e.extend({},e.fn.fancyNews.defaults,r);var s,o,u,a,f=[],l=[],c=[],h=[],p=[],d=[],v=0,m=true,g=false,y="next";return this.each(function(){b(this)})};e.fn.fancyNews.defaults={width:500,height:420,previewOffset:2,maxWords:60,previewsPerPage:3,numOfEntries:10,slideTime:0,longestImageSide:100,feed:"",backgroundColor:"#333230",backgroundOverColor:"#736D61",useLinks:false,targetWindow:"_blank"}})(jQuery)